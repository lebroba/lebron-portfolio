var ee=Object.defineProperty;var X=t=>{throw TypeError(t)};var te=(t,i,e)=>i in t?ee(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var c=(t,i,e)=>te(t,typeof i!="symbol"?i+"":i,e),Y=(t,i,e)=>i.has(t)||X("Cannot "+e);var o=(t,i,e)=>(Y(t,i,"read from private field"),e?e.call(t):i.get(t)),a=(t,i,e)=>i.has(t)?X("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(t):i.set(t,e),d=(t,i,e,r)=>(Y(t,i,"write to private field"),r?r.call(t,e):i.set(t,e),e);class z extends Event{constructor(e,r){super(e);c(this,"track");this.track=r.track}}const H=new WeakMap;function n(t){return H.get(t)??ie(t,{})}function ie(t,i){let e=H.get(t);return e||H.set(t,e={}),Object.assign(e,i)}function D(t,i){const e=t.videoTracks;n(i).media=t,n(i).renditionSet||(n(i).renditionSet=new Set);const r=n(e).trackSet;r.add(i);const s=r.size-1;s in W.prototype||Object.defineProperty(W.prototype,s,{get(){return[...n(this).trackSet][s]}}),queueMicrotask(()=>{e.dispatchEvent(new z("addtrack",{track:i}))})}function U(t){var r;const i=(r=n(t).media)==null?void 0:r.videoTracks;if(!i)return;n(i).trackSet.delete(t),queueMicrotask(()=>{i.dispatchEvent(new z("removetrack",{track:t}))})}function ne(t){const i=n(t).media.videoTracks??[];let e=!1;for(const r of i)r!==t&&(r.selected=!1,e=!0);if(e){if(n(i).changeRequested)return;n(i).changeRequested=!0,queueMicrotask(()=>{delete n(i).changeRequested,i.dispatchEvent(new Event("change"))})}}var k,g,p,q,O;class W extends EventTarget{constructor(){super();a(this,q);a(this,k);a(this,g);a(this,p);n(this).trackSet=new Set}[Symbol.iterator](){return o(this,q,O).values()}get length(){return o(this,q,O).size}getTrackById(e){return[...o(this,q,O)].find(r=>r.id===e)??null}get selectedIndex(){return[...o(this,q,O)].findIndex(e=>e.selected)}get onaddtrack(){return o(this,k)}set onaddtrack(e){o(this,k)&&(this.removeEventListener("addtrack",o(this,k)),d(this,k,void 0)),typeof e=="function"&&(d(this,k,e),this.addEventListener("addtrack",e))}get onremovetrack(){return o(this,g)}set onremovetrack(e){o(this,g)&&(this.removeEventListener("removetrack",o(this,g)),d(this,g,void 0)),typeof e=="function"&&(d(this,g,e),this.addEventListener("removetrack",e))}get onchange(){return o(this,p)}set onchange(e){o(this,p)&&(this.removeEventListener("change",o(this,p)),d(this,p,void 0)),typeof e=="function"&&(d(this,p,e),this.addEventListener("change",e))}}k=new WeakMap,g=new WeakMap,p=new WeakMap,q=new WeakSet,O=function(){return n(this).trackSet};class F extends Event{constructor(e,r){super(e);c(this,"rendition");this.rendition=r.rendition}}function re(t,i){const e=n(t).media.videoRenditions;n(i).media=n(t).media,n(i).track=t;const r=n(t).renditionSet;r.add(i);const s=r.size-1;s in G.prototype||Object.defineProperty(G.prototype,s,{get(){return b(this)[s]}}),queueMicrotask(()=>{t.selected&&e.dispatchEvent(new F("addrendition",{rendition:i}))})}function oe(t){const i=n(t).media.videoRenditions,e=n(t).track;n(e).renditionSet.delete(t),queueMicrotask(()=>{n(t).track.selected&&i.dispatchEvent(new F("removerendition",{rendition:t}))})}function se(t){const i=n(t).media.videoRenditions;!i||n(i).changeRequested||(n(i).changeRequested=!0,queueMicrotask(()=>{delete n(i).changeRequested,n(t).track.selected&&i.dispatchEvent(new Event("change"))}))}function b(t){return[...n(t).media.videoTracks].filter(e=>e.selected).flatMap(e=>[...n(e).renditionSet])}var T,y,R;class G extends EventTarget{constructor(){super(...arguments);a(this,T);a(this,y);a(this,R)}[Symbol.iterator](){return b(this).values()}get length(){return b(this).length}getRenditionById(e){return b(this).find(r=>`${r.id}`==`${e}`)??null}get selectedIndex(){return b(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[r,s]of b(this).entries())s.selected=r===e}get onaddrendition(){return o(this,T)}set onaddrendition(e){o(this,T)&&(this.removeEventListener("addrendition",o(this,T)),d(this,T,void 0)),typeof e=="function"&&(d(this,T,e),this.addEventListener("addrendition",e))}get onremoverendition(){return o(this,y)}set onremoverendition(e){o(this,y)&&(this.removeEventListener("removerendition",o(this,y)),d(this,y,void 0)),typeof e=="function"&&(d(this,y,e),this.addEventListener("removerendition",e))}get onchange(){return o(this,R)}set onchange(e){o(this,R)&&(this.removeEventListener("change",o(this,R)),d(this,R,void 0)),typeof e=="function"&&(d(this,R,e),this.addEventListener("change",e))}}T=new WeakMap,y=new WeakMap,R=new WeakMap;var A;class de{constructor(){c(this,"src");c(this,"id");c(this,"width");c(this,"height");c(this,"bitrate");c(this,"frameRate");c(this,"codec");a(this,A,!1)}get selected(){return o(this,A)}set selected(i){o(this,A)!==i&&(d(this,A,i),se(this))}}A=new WeakMap;var V;class M{constructor(){c(this,"id");c(this,"kind");c(this,"label","");c(this,"language","");c(this,"sourceBuffer");a(this,V,!1)}addRendition(i,e,r,s,h,u){const f=new de;return f.src=i,f.width=e,f.height=r,f.frameRate=u,f.bitrate=h,f.codec=s,re(this,f),f}removeRendition(i){oe(i)}get selected(){return o(this,V)}set selected(i){o(this,V)!==i&&(d(this,V,i),i===!0&&ne(this))}}V=new WeakMap;function ce(t,i){const e=n(t).media.audioRenditions;n(i).media=n(t).media,n(i).track=t;const r=n(t).renditionSet;r.add(i);const s=r.size-1;s in J.prototype||Object.defineProperty(J.prototype,s,{get(){return x(this)[s]}}),queueMicrotask(()=>{t.enabled&&e.dispatchEvent(new F("addrendition",{rendition:i}))})}function ae(t){const i=n(t).media.audioRenditions,e=n(t).track;n(e).renditionSet.delete(t),queueMicrotask(()=>{n(t).track.enabled&&i.dispatchEvent(new F("removerendition",{rendition:t}))})}function ue(t){const i=n(t).media.audioRenditions;!i||n(i).changeRequested||(n(i).changeRequested=!0,queueMicrotask(()=>{delete n(i).changeRequested,n(t).track.enabled&&i.dispatchEvent(new Event("change"))}))}function x(t){return[...n(t).media.audioTracks].filter(e=>e.enabled).flatMap(e=>[...n(e).renditionSet])}var L,S,m;class J extends EventTarget{constructor(){super(...arguments);a(this,L);a(this,S);a(this,m)}[Symbol.iterator](){return x(this).values()}get length(){return x(this).length}getRenditionById(e){return x(this).find(r=>`${r.id}`==`${e}`)??null}get selectedIndex(){return x(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[r,s]of x(this).entries())s.selected=r===e}get onaddrendition(){return o(this,L)}set onaddrendition(e){o(this,L)&&(this.removeEventListener("addrendition",o(this,L)),d(this,L,void 0)),typeof e=="function"&&(d(this,L,e),this.addEventListener("addrendition",e))}get onremoverendition(){return o(this,S)}set onremoverendition(e){o(this,S)&&(this.removeEventListener("removerendition",o(this,S)),d(this,S,void 0)),typeof e=="function"&&(d(this,S,e),this.addEventListener("removerendition",e))}get onchange(){return o(this,m)}set onchange(e){o(this,m)&&(this.removeEventListener("change",o(this,m)),d(this,m,void 0)),typeof e=="function"&&(d(this,m,e),this.addEventListener("change",e))}}L=new WeakMap,S=new WeakMap,m=new WeakMap;var I;class he{constructor(){c(this,"src");c(this,"id");c(this,"bitrate");c(this,"codec");a(this,I,!1)}get selected(){return o(this,I)}set selected(i){o(this,I)!==i&&(d(this,I,i),ue(this))}}I=new WeakMap;function K(t,i){const e=t.audioTracks;n(i).media=t,n(i).renditionSet||(n(i).renditionSet=new Set);const r=n(e).trackSet;r.add(i);const s=r.size-1;s in Q.prototype||Object.defineProperty(Q.prototype,s,{get(){return[...n(this).trackSet][s]}}),queueMicrotask(()=>{e.dispatchEvent(new z("addtrack",{track:i}))})}function N(t){var r;const i=(r=n(t).media)==null?void 0:r.audioTracks;if(!i)return;n(i).trackSet.delete(t),queueMicrotask(()=>{i.dispatchEvent(new z("removetrack",{track:t}))})}function fe(t){const i=n(t).media.audioTracks;!i||n(i).changeRequested||(n(i).changeRequested=!0,queueMicrotask(()=>{delete n(i).changeRequested,i.dispatchEvent(new Event("change"))}))}var E,l,w,P,j;class Q extends EventTarget{constructor(){super();a(this,P);a(this,E);a(this,l);a(this,w);n(this).trackSet=new Set}[Symbol.iterator](){return o(this,P,j).values()}get length(){return o(this,P,j).size}getTrackById(e){return[...o(this,P,j)].find(r=>r.id===e)??null}get onaddtrack(){return o(this,E)}set onaddtrack(e){o(this,E)&&(this.removeEventListener("addtrack",o(this,E)),d(this,E,void 0)),typeof e=="function"&&(d(this,E,e),this.addEventListener("addtrack",e))}get onremovetrack(){return o(this,l)}set onremovetrack(e){o(this,l)&&(this.removeEventListener("removetrack",o(this,l)),d(this,l,void 0)),typeof e=="function"&&(d(this,l,e),this.addEventListener("removetrack",e))}get onchange(){return o(this,w)}set onchange(e){o(this,w)&&(this.removeEventListener("change",o(this,w)),d(this,w,void 0)),typeof e=="function"&&(d(this,w,e),this.addEventListener("change",e))}}E=new WeakMap,l=new WeakMap,w=new WeakMap,P=new WeakSet,j=function(){return n(this).trackSet};var $;class C{constructor(){c(this,"id");c(this,"kind");c(this,"label","");c(this,"language","");c(this,"sourceBuffer");a(this,$,!1)}addRendition(i,e,r){const s=new he;return s.src=i,s.codec=e,s.bitrate=r,ce(this,s),s}removeRendition(i){ae(i)}get enabled(){return o(this,$)}set enabled(i){o(this,$)!==i&&(d(this,$,i),fe(this))}}$=new WeakMap;const Z=B(globalThis.HTMLMediaElement,"video"),_=B(globalThis.HTMLMediaElement,"audio");function pe(t){if(!(t!=null&&t.prototype))return t;const i=B(t,"video");(!i||`${i}`.includes("[native code]"))&&Object.defineProperty(t.prototype,"videoTracks",{get(){return ve(this)}});const e=B(t,"audio");(!e||`${e}`.includes("[native code]"))&&Object.defineProperty(t.prototype,"audioTracks",{get(){return ke(this)}}),"addVideoTrack"in t.prototype||(t.prototype.addVideoTrack=function(h,u="",f=""){const v=new M;return v.kind=h,v.label=u,v.language=f,D(this,v),v}),"removeVideoTrack"in t.prototype||(t.prototype.removeVideoTrack=U),"addAudioTrack"in t.prototype||(t.prototype.addAudioTrack=function(h,u="",f=""){const v=new C;return v.kind=h,v.label=u,v.language=f,K(this,v),v}),"removeAudioTrack"in t.prototype||(t.prototype.removeAudioTrack=N),"videoRenditions"in t.prototype||Object.defineProperty(t.prototype,"videoRenditions",{get(){return r(this)}});const r=h=>{let u=n(h).videoRenditions;return u||(u=new G,n(u).media=h,n(h).videoRenditions=u),u};"audioRenditions"in t.prototype||Object.defineProperty(t.prototype,"audioRenditions",{get(){return s(this)}});const s=h=>{let u=n(h).audioRenditions;return u||(u=new J,n(u).media=h,n(h).audioRenditions=u),u};return t}function B(t,i){var e;if(t!=null&&t.prototype)return(e=Object.getOwnPropertyDescriptor(t.prototype,`${i}Tracks`))==null?void 0:e.get}function ve(t){let i=n(t).videoTracks;if(!i&&(i=new W,n(t).videoTracks=i,Z)){const e=Z.call(t.nativeEl??t);for(const r of e)D(t,r);e.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),e.addEventListener("addtrack",r=>{if([...i].some(s=>s instanceof M)){for(const s of e)U(s);return}D(t,r.track)}),e.addEventListener("removetrack",r=>{U(r.track)})}return i}function ke(t){let i=n(t).audioTracks;if(!i&&(i=new Q,n(t).audioTracks=i,_)){const e=_.call(t.nativeEl??t);for(const r of e)K(t,r);e.addEventListener("change",()=>{i.dispatchEvent(new Event("change"))}),e.addEventListener("addtrack",r=>{if([...i].some(s=>s instanceof C)){for(const s of e)N(s);return}K(t,r.track)}),e.addEventListener("removetrack",r=>{N(r.track)})}return i}export{pe as M};
