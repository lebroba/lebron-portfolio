"use strict";var Lt=Object.create;var B=Object.defineProperty;var Nt=Object.getOwnPropertyDescriptor;var It=Object.getOwnPropertyNames;var St=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty;var wt=(e,t)=>{for(var r in t)B(e,r,{get:t[r],enumerable:!0})},Pe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of It(t))!At.call(e,o)&&o!==r&&B(e,o,{get:()=>t[o],enumerable:!(n=Nt(t,o))||n.enumerable});return e};var _e=(e,t,r)=>(r=e!=null?Lt(St(e)):{},Pe(t||!e||!e.__esModule?B(r,"default",{value:e,enumerable:!0}):r,e)),Ot=e=>Pe(B({},"__esModule",{value:!0}),e);var lr={};wt(lr,{AutoplayTypes:()=>H,CmcdTypeValues:()=>Ht,CmcdTypes:()=>A,ExtensionMimeTypeMap:()=>N,Hls:()=>g,MaxResolution:()=>Ft,MediaError:()=>y,MimeTypeShorthandMap:()=>V,MinResolution:()=>Wt,MuxErrorCategory:()=>C,MuxErrorCode:()=>b,MuxJWTAud:()=>Q,PlaybackTypes:()=>j,RenditionOrder:()=>Yt,StreamTypes:()=>_,addChapters:()=>fe,addCuePoints:()=>ue,addTextTrack:()=>z,allMediaTypes:()=>Kt,errorCategoryToTokenNameOrPrefix:()=>U,fetchAndDispatchMuxMetadata:()=>te,generatePlayerInitTime:()=>rr,generateUUID:()=>ft,getActiveChapter:()=>Te,getActiveCuePoint:()=>de,getAppCertificate:()=>Dt,getChapters:()=>Be,getCuePoints:()=>Ye,getCurrentPdt:()=>Je,getDRMConfig:()=>bt,getEnded:()=>Et,getError:()=>Tt,getLicenseKey:()=>Ct,getLiveEdgeStart:()=>ir,getMediaPlaylistFromMultivariantPlaylist:()=>ot,getMetadata:()=>ar,getMultivariantPlaylistSessionData:()=>at,getSeekable:()=>Re,getStartDate:()=>je,getStreamInfoFromHlsjsLevelDetails:()=>dt,getStreamInfoFromPlaylist:()=>it,getStreamInfoFromSrcAndType:()=>ct,getStreamType:()=>Ee,getStreamTypeConfig:()=>xt,getTargetLiveWindow:()=>sr,getTextTrack:()=>w,i18n:()=>M,initialize:()=>ur,isKeyOf:()=>O,isMuxVideoSrc:()=>Ce,isPseudoEnded:()=>mt,isStuckOnLastFragment:()=>be,loadMedia:()=>_t,mux:()=>$.default,muxMediaState:()=>P,parseJwt:()=>G,parseTagAttributes:()=>st,removeTextTrack:()=>Ke,setupChapters:()=>ye,setupCuePoints:()=>le,setupHls:()=>Rt,setupMux:()=>Pt,setupNativeFairplayDRM:()=>vt,shorthandKeys:()=>Vt,teardown:()=>gt,toAppCertURL:()=>De,toDRMTypeFromKeySystem:()=>nt,toLicenseKeyURL:()=>Y,toMuxVideoURL:()=>nr,toPlaybackIdFromSrc:()=>Me,toPlaybackIdParts:()=>K,updateStreamInfoFromHlsjsLevelDetails:()=>lt,updateStreamInfoFromSrc:()=>ut});module.exports=Ot(lr);var $=_e(require("mux-embed"));var ke=_e(require("hls.js")),g=ke.default;var C={VIDEO:"video",THUMBNAIL:"thumbnail",STORYBOARD:"storyboard",DRM:"drm"},b={NOT_AN_ERROR:0,NETWORK_OFFLINE:2000002,NETWORK_UNKNOWN_ERROR:2e6,NETWORK_NO_STATUS:2000001,NETWORK_INVALID_URL:24e5,NETWORK_NOT_FOUND:2404e3,NETWORK_NOT_READY:2412e3,NETWORK_GENERIC_SERVER_FAIL:25e5,NETWORK_TOKEN_MISSING:2403201,NETWORK_TOKEN_MALFORMED:2412202,NETWORK_TOKEN_EXPIRED:2403210,NETWORK_TOKEN_AUD_MISSING:2403221,NETWORK_TOKEN_AUD_MISMATCH:2403222,NETWORK_TOKEN_SUB_MISMATCH:2403232,ENCRYPTED_ERROR:5e6,ENCRYPTED_UNSUPPORTED_KEY_SYSTEM:5000001,ENCRYPTED_GENERATE_REQUEST_FAILED:5000002,ENCRYPTED_UPDATE_LICENSE_FAILED:5000003,ENCRYPTED_UPDATE_SERVER_CERT_FAILED:5000004,ENCRYPTED_CDM_ERROR:5000005,ENCRYPTED_OUTPUT_RESTRICTED:5000006,ENCRYPTED_MISSING_TOKEN:5000002},U=e=>e===C.VIDEO?"playback":e,L=class L extends Error{constructor(t,r=L.MEDIA_ERR_CUSTOM,n,o){var a;super(t),this.name="MediaError",this.code=r,this.context=o,this.fatal=n!=null?n:r>=L.MEDIA_ERR_NETWORK&&r<=L.MEDIA_ERR_ENCRYPTED,this.message||(this.message=(a=L.defaultMessages[this.code])!=null?a:"")}};L.MEDIA_ERR_ABORTED=1,L.MEDIA_ERR_NETWORK=2,L.MEDIA_ERR_DECODE=3,L.MEDIA_ERR_SRC_NOT_SUPPORTED=4,L.MEDIA_ERR_ENCRYPTED=5,L.MEDIA_ERR_CUSTOM=100,L.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var y=L;var Ut=e=>e==null,O=(e,t)=>Ut(t)?!1:e in t,H={ANY:"any",MUTED:"muted"},_={ON_DEMAND:"on-demand",LIVE:"live",UNKNOWN:"unknown"},j={MSE:"mse",NATIVE:"native"},A={HEADER:"header",QUERY:"query",NONE:"none"},Ht=Object.values(A),N={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},V={HLS:N.M3U8},Vt=Object.keys(V),Kt=[...Object.values(N),"hls","HLS"],Ft={upTo720p:"720p",upTo1080p:"1080p",upTo1440p:"1440p",upTo2160p:"2160p"},Wt={noLessThan480p:"480p",noLessThan540p:"540p",noLessThan720p:"720p",noLessThan1080p:"1080p",noLessThan1440p:"1440p",noLessThan2160p:"2160p"},Yt={DESCENDING:"desc"};var $t="en",J={code:$t};var v=(e,t,r,n,o=e)=>{o.addEventListener(t,r,n),e.addEventListener("teardown",()=>{o.removeEventListener(t,r)},{once:!0})};function he(e,t,r){t&&r>t&&(r=t);for(let n=0;n<e.length;n++)if(e.start(n)<=r&&e.end(n)>=r)return!0;return!1}var K=e=>{let t=e.indexOf("?");if(t<0)return[e];let r=e.slice(0,t),n=e.slice(t);return[r,n]},F=e=>{let{type:t}=e;if(t){let r=t.toUpperCase();return O(r,V)?V[r]:t}return Bt(e)},oe=e=>e==="VOD"?_.ON_DEMAND:_.LIVE,ae=e=>e==="EVENT"?Number.POSITIVE_INFINITY:e==="VOD"?Number.NaN:0,Bt=e=>{let{src:t}=e;if(!t)return"";let r="";try{r=new URL(t).pathname}catch{console.error("invalid url")}let n=r.lastIndexOf(".");if(n<0)return Jt(e)?N.M3U8:"";let a=r.slice(n+1).toUpperCase();return O(a,N)?N[a]:""},jt="mux.com",Jt=({src:e,customDomain:t=jt})=>{let r;try{r=new URL(`${e}`)}catch{return!1}let n=r.protocol==="https:",o=r.hostname===`stream.${t}`.toLowerCase(),a=r.pathname.split("/"),i=a.length===2,c=!(a!=null&&a[1].includes("."));return n&&o&&i&&c},G=e=>{let t=(e!=null?e:"").split(".")[1];if(t)try{let r=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch{return}},Le=({exp:e},t=Date.now())=>!e||e*1e3<t,Ne=({sub:e},t)=>e!==t,Ie=({aud:e},t)=>!e,Se=({aud:e},t)=>e!==t,Ae="en";function M(e,t=!0){var o,a;let r=t&&(a=(o=J)==null?void 0:o[e])!=null?a:e,n=t?J.code:Ae;return new ne(r,n)}var ne=class{constructor(t,r=(n=>(n=J)!=null?n:Ae)()){this.message=t,this.locale=r}format(t){return this.message.replace(/\{(\w+)\}/g,(r,n)=>{var o;return(o=t[n])!=null?o:""})}toString(){return this.message}};var Gt=Object.values(H),we=e=>typeof e=="boolean"||typeof e=="string"&&Gt.includes(e),Oe=(e,t,r)=>{let{autoplay:n}=e,o=!1,a=!1,i=we(n)?n:!!n,c=()=>{o||v(t,"playing",()=>{o=!0},{once:!0})};if(c(),v(t,"loadstart",()=>{o=!1,c(),se(t,i)},{once:!0}),v(t,"loadstart",()=>{r||(e.streamType&&e.streamType!==_.UNKNOWN?a=e.streamType===_.LIVE:a=!Number.isFinite(t.duration)),se(t,i)},{once:!0}),r&&r.once(g.Events.LEVEL_LOADED,(u,s)=>{var d;e.streamType&&e.streamType!==_.UNKNOWN?a=e.streamType===_.LIVE:a=(d=s.details.live)!=null?d:!1}),!i){let u=()=>{!a||Number.isFinite(e.startTime)||(r!=null&&r.liveSyncPosition?t.currentTime=r.liveSyncPosition:Number.isFinite(t.seekable.end(0))&&(t.currentTime=t.seekable.end(0)))};r&&v(t,"play",()=>{t.preload==="metadata"?r.once(g.Events.LEVEL_UPDATED,u):u()},{once:!0})}return u=>{o||(i=we(u)?u:!!u,se(t,i))}},se=(e,t)=>{if(!t)return;let r=e.muted,n=()=>e.muted=r;switch(t){case H.ANY:e.play().catch(()=>{e.muted=!0,e.play().catch(n)});break;case H.MUTED:e.muted=!0,e.play().catch(n);break;default:e.play().catch(()=>{});break}};var Ue=({preload:e,src:t},r,n)=>{let o=d=>{d!=null&&["","none","metadata","auto"].includes(d)?r.setAttribute("preload",d):r.removeAttribute("preload")};if(!n)return o(e),o;let a=!1,i=!1,c=n.config.maxBufferLength,f=n.config.maxBufferSize,u=d=>{o(d);let l=d!=null?d:r.preload;i||l==="none"||(l==="metadata"?(n.config.maxBufferLength=1,n.config.maxBufferSize=1):(n.config.maxBufferLength=c,n.config.maxBufferSize=f),s())},s=()=>{!a&&t&&(a=!0,n.loadSource(t))};return v(r,"play",()=>{i=!0,n.config.maxBufferLength=c,n.config.maxBufferSize=f,s()},{once:!0}),u(e),u};function He(e,t){var f;if(!("videoTracks"in e))return;let r=new WeakMap;t.on(g.Events.MANIFEST_PARSED,function(u,s){c();let d=e.addVideoTrack("main");d.selected=!0;for(let[l,p]of s.levels.entries()){let T=d.addRendition(p.url[0],p.width,p.height,p.videoCodec,p.bitrate);r.set(p,`${l}`),T.id=`${l}`}}),t.on(g.Events.AUDIO_TRACKS_UPDATED,function(u,s){i();for(let d of s.audioTracks){let l=d.default?"main":"alternative",p=e.addAudioTrack(l,d.name,d.lang);p.id=`${d.id}`,d.default&&(p.enabled=!0)}}),e.audioTracks.addEventListener("change",()=>{var d;let u=+((d=[...e.audioTracks].find(l=>l.enabled))==null?void 0:d.id),s=t.audioTracks.map(l=>l.id);u!=t.audioTrack&&s.includes(u)&&(t.audioTrack=u)}),t.on(g.Events.LEVELS_UPDATED,function(u,s){var p;let d=e.videoTracks[(p=e.videoTracks.selectedIndex)!=null?p:0];if(!d)return;let l=s.levels.map(T=>r.get(T));for(let T of e.videoRenditions)T.id&&!l.includes(T.id)&&d.removeRendition(T)});let n=u=>{let s=u.target.selectedIndex;s!=t.nextLevel&&o(s)},o=u=>{let s=e.currentTime,d=!1,l=(p,T)=>{d||(d=!Number.isFinite(T.endOffset))};t.on(g.Events.BUFFER_FLUSHING,l),t.nextLevel=u,t.off(g.Events.BUFFER_FLUSHING,l),d||t.trigger(g.Events.BUFFER_FLUSHING,{startOffset:s+10,endOffset:1/0,type:"video"})};(f=e.videoRenditions)==null||f.addEventListener("change",n);let a=()=>{for(let u of e.videoTracks)e.removeVideoTrack(u)},i=()=>{for(let u of e.audioTracks)e.removeAudioTrack(u)},c=()=>{a(),i()};t.once(g.Events.DESTROYING,c)}var ie=e=>"time"in e?e.time:e.startTime;function Ve(e,t){t.on(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,(o,{tracks:a})=>{a.forEach(i=>{var s,d;let c=(s=i.subtitleTrack)!=null?s:i.closedCaptions,f=t.subtitleTracks.findIndex(({lang:l,name:p,type:T})=>l==(c==null?void 0:c.lang)&&p===i.label&&T.toLowerCase()===i.kind),u=((d=i._id)!=null?d:i.default)?"default":`${i.kind}${f}`;z(e,i.kind,i.label,c==null?void 0:c.lang,u,i.default)})});let r=()=>{if(!t.subtitleTracks.length)return;let o=Array.from(e.textTracks).find(c=>c.id&&c.mode==="showing"&&["subtitles","captions"].includes(c.kind));if(!o)return;let a=t.subtitleTracks[t.subtitleTrack],i=a?a.default?"default":`${t.subtitleTracks[t.subtitleTrack].type.toLowerCase()}${t.subtitleTrack}`:void 0;if(t.subtitleTrack<0||(o==null?void 0:o.id)!==i){let c=t.subtitleTracks.findIndex(({lang:f,name:u,type:s,default:d})=>o.id==="default"&&d||f==o.language&&u===o.label&&s.toLowerCase()===o.kind);t.subtitleTrack=c}(o==null?void 0:o.id)===i&&o.cues&&Array.from(o.cues).forEach(c=>{o.addCue(c)})};e.textTracks.addEventListener("change",r),t.on(g.Events.CUES_PARSED,(o,{track:a,cues:i})=>{let c=e.textTracks.getTrackById(a);if(!c)return;let f=c.mode==="disabled";f&&(c.mode="hidden"),i.forEach(u=>{var s;(s=c.cues)!=null&&s.getCueById(u.id)||c.addCue(u)}),f&&(c.mode="disabled")}),t.once(g.Events.DESTROYING,()=>{e.textTracks.removeEventListener("change",r),e.querySelectorAll("track[data-removeondestroy]").forEach(a=>{a.remove()})});let n=()=>{Array.from(e.textTracks).forEach(o=>{var a,i;if(!["subtitles","caption"].includes(o.kind)&&(o.label==="thumbnails"||o.kind==="chapters")){if(!((a=o.cues)!=null&&a.length)){let c="track";o.kind&&(c+=`[kind="${o.kind}"]`),o.label&&(c+=`[label="${o.label}"]`);let f=e.querySelector(c),u=(i=f==null?void 0:f.getAttribute("src"))!=null?i:"";f==null||f.removeAttribute("src"),setTimeout(()=>{f==null||f.setAttribute("src",u)},0)}o.mode!=="hidden"&&(o.mode="hidden")}})};t.once(g.Events.MANIFEST_LOADED,n),t.once(g.Events.MEDIA_ATTACHED,n)}function z(e,t,r,n,o,a){let i=document.createElement("track");return i.kind=t,i.label=r,n&&(i.srclang=n),o&&(i.id=o),a&&(i.default=!0),i.track.mode=["subtitles","captions"].includes(t)?"disabled":"hidden",i.setAttribute("data-removeondestroy",""),e.append(i),i.track}function Ke(e,t){let r=Array.prototype.find.call(e.querySelectorAll("track"),n=>n.track===t);r==null||r.remove()}function w(e,t,r){var n;return(n=Array.from(e.querySelectorAll("track")).find(o=>o.track.label===t&&o.track.kind===r))==null?void 0:n.track}async function Fe(e,t,r,n){let o=w(e,r,n);return o||(o=z(e,n,r),o.mode="hidden",await new Promise(a=>setTimeout(()=>a(void 0),0))),o.mode!=="hidden"&&(o.mode="hidden"),[...t].sort((a,i)=>ie(i)-ie(a)).forEach(a=>{var f,u;let i=a.value,c=ie(a);if("endTime"in a&&a.endTime!=null)o==null||o.addCue(new VTTCue(c,a.endTime,n==="chapters"?i:JSON.stringify(i!=null?i:null)));else{let s=Array.prototype.findIndex.call(o==null?void 0:o.cues,T=>T.startTime>=c),d=(f=o==null?void 0:o.cues)==null?void 0:f[s],l=d?d.startTime:Number.isFinite(e.duration)?e.duration:Number.MAX_SAFE_INTEGER,p=(u=o==null?void 0:o.cues)==null?void 0:u[s-1];p&&(p.endTime=c),o==null||o.addCue(new VTTCue(c,l,n==="chapters"?i:JSON.stringify(i!=null?i:null)))}}),e.textTracks.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),o}var ce="cuepoints",We=Object.freeze({label:ce});async function ue(e,t,r=We){return Fe(e,t,r.label,"metadata")}var q=e=>({time:e.startTime,value:JSON.parse(e.text)});function Ye(e,t={label:ce}){let r=w(e,t.label,"metadata");return r!=null&&r.cues?Array.from(r.cues,n=>q(n)):[]}function de(e,t={label:ce}){var a,i;let r=w(e,t.label,"metadata");if(!((a=r==null?void 0:r.activeCues)!=null&&a.length))return;if(r.activeCues.length===1)return q(r.activeCues[0]);let{currentTime:n}=e,o=Array.prototype.find.call((i=r.activeCues)!=null?i:[],({startTime:c,endTime:f})=>c<=n&&f>n);return q(o||r.activeCues[0])}async function le(e,t=We){return new Promise(r=>{v(e,"loadstart",async()=>{let n=await ue(e,[],t);v(e,"cuechange",()=>{let o=de(e);if(o){let a=new CustomEvent("cuepointchange",{composed:!0,bubbles:!0,detail:o});e.dispatchEvent(a)}},{},n),r(n)})})}var pe="chapters",$e=Object.freeze({label:pe}),X=e=>({startTime:e.startTime,endTime:e.endTime,value:e.text});async function fe(e,t,r=$e){return Fe(e,t,r.label,"chapters")}function Be(e,t={label:pe}){var n;let r=w(e,t.label,"chapters");return(n=r==null?void 0:r.cues)!=null&&n.length?Array.from(r.cues,o=>X(o)):[]}function Te(e,t={label:pe}){var a,i;let r=w(e,t.label,"chapters");if(!((a=r==null?void 0:r.activeCues)!=null&&a.length))return;if(r.activeCues.length===1)return X(r.activeCues[0]);let{currentTime:n}=e,o=Array.prototype.find.call((i=r.activeCues)!=null?i:[],({startTime:c,endTime:f})=>c<=n&&f>n);return X(o||r.activeCues[0])}async function ye(e,t=$e){return new Promise(r=>{v(e,"loadstart",async()=>{let n=await fe(e,[],t);v(e,"cuechange",()=>{let o=Te(e);if(o){let a=new CustomEvent("chapterchange",{composed:!0,bubbles:!0,detail:o});e.dispatchEvent(a)}},{},n),r(n)})})}function je(e,t){if(t){let r=t.playingDate;if(r!=null)return new Date(r.getTime()-e.currentTime*1e3)}return typeof e.getStartDate=="function"?e.getStartDate():new Date(NaN)}function Je(e,t){if(t&&t.playingDate)return t.playingDate;if(typeof e.getStartDate=="function"){let r=e.getStartDate();return new Date(r.getTime()+e.currentTime*1e3)}return new Date(NaN)}var Q={VIDEO:"v",THUMBNAIL:"t",STORYBOARD:"s",DRM:"d"},qt=e=>{if(e===C.VIDEO)return Q.VIDEO;if(e===C.DRM)return Q.DRM},Xt=(e,t)=>{var o,a;let r=U(e),n=`${r}Token`;return(o=t.tokens)!=null&&o[r]?(a=t.tokens)==null?void 0:a[r]:O(n,t)?t[n]:void 0},W=(e,t,r,n,o=!1,a=!(i=>(i=globalThis.navigator)==null?void 0:i.onLine)())=>{var R,h;if(a){let E=M("Your device appears to be offline",o),D=void 0,m=y.MEDIA_ERR_NETWORK,k=new y(E,m,!1,D);return k.errorCategory=t,k.muxCode=b.NETWORK_OFFLINE,k.data=e,k}let c="status"in e?e.status:e.code,f=Date.now(),u=y.MEDIA_ERR_NETWORK;if(c===200)return;let s=U(t),d=Xt(t,r),l=qt(t),[p]=K((R=r.playbackId)!=null?R:"");if(!c||!p)return;let T=G(d);if(d&&!T){let E=M("The {tokenNamePrefix}-token provided is invalid or malformed.",o).format({tokenNamePrefix:s}),D=M("Compact JWT string: {token}",o).format({token:d}),m=new y(E,u,!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_TOKEN_MALFORMED,m.data=e,m}if(c>=500){let E=new y("",u,n!=null?n:!0);return E.errorCategory=t,E.muxCode=b.NETWORK_UNKNOWN_ERROR,E}if(c===403)if(T){if(Le(T,f)){let E={timeStyle:"medium",dateStyle:"medium"},D=M("The video\u2019s secured {tokenNamePrefix}-token has expired.",o).format({tokenNamePrefix:s}),m=M("Expired at: {expiredDate}. Current time: {currentDate}.",o).format({expiredDate:new Intl.DateTimeFormat("en",E).format((h=T.exp)!=null?h:0*1e3),currentDate:new Intl.DateTimeFormat("en",E).format(f)}),k=new y(D,u,!0,m);return k.errorCategory=t,k.muxCode=b.NETWORK_TOKEN_EXPIRED,k.data=e,k}if(Ne(T,p)){let E=M("The video\u2019s playback ID does not match the one encoded in the {tokenNamePrefix}-token.",o).format({tokenNamePrefix:s}),D=M("Specified playback ID: {playbackId} and the playback ID encoded in the {tokenNamePrefix}-token: {tokenPlaybackId}",o).format({tokenNamePrefix:s,playbackId:p,tokenPlaybackId:T.sub}),m=new y(E,u,!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_TOKEN_SUB_MISMATCH,m.data=e,m}if(Ie(T,l)){let E=M("The {tokenNamePrefix}-token is formatted with incorrect information.",o).format({tokenNamePrefix:s}),D=M("The {tokenNamePrefix}-token has no aud value. aud value should be {expectedAud}.",o).format({tokenNamePrefix:s,expectedAud:l}),m=new y(E,u,!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_TOKEN_AUD_MISSING,m.data=e,m}if(Se(T,l)){let E=M("The {tokenNamePrefix}-token is formatted with incorrect information.",o).format({tokenNamePrefix:s}),D=M("The {tokenNamePrefix}-token has an incorrect aud value: {aud}. aud value should be {expectedAud}.",o).format({tokenNamePrefix:s,expectedAud:l,aud:T.aud}),m=new y(E,u,!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_TOKEN_AUD_MISMATCH,m.data=e,m}}else{let E=M("Authorization error trying to access this {category} URL. If this is a signed URL, you might need to provide a {tokenNamePrefix}-token.",o).format({tokenNamePrefix:s,category:t}),D=M("Specified playback ID: {playbackId}",o).format({playbackId:p}),m=new y(E,u,n!=null?n:!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_TOKEN_MISSING,m.data=e,m}if(c===412){let E=M("This playback-id may belong to a live stream that is not currently active or an asset that is not ready.",o),D=M("Specified playback ID: {playbackId}",o).format({playbackId:p}),m=new y(E,u,n!=null?n:!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_NOT_READY,m.streamType=r.streamType===_.LIVE?"live":r.streamType===_.ON_DEMAND?"on-demand":"unknown",m.data=e,m}if(c===404){let E=M("This URL or playback-id does not exist. You may have used an Asset ID or an ID from a different resource.",o),D=M("Specified playback ID: {playbackId}",o).format({playbackId:p}),m=new y(E,u,n!=null?n:!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_NOT_FOUND,m.data=e,m}if(c===400){let E=M("The URL or playback-id was invalid. You may have used an invalid value as a playback-id."),D=M("Specified playback ID: {playbackId}",o).format({playbackId:p}),m=new y(E,u,n!=null?n:!0,D);return m.errorCategory=t,m.muxCode=b.NETWORK_INVALID_URL,m.data=e,m}let x=new y("",u,n!=null?n:!0);return x.errorCategory=t,x.muxCode=b.NETWORK_UNKNOWN_ERROR,x.data=e,x};var Ge=g.DefaultConfig.capLevelController,Z=class Z extends Ge{constructor(t){super(t)}get levels(){var t;return(t=this.hls.levels)!=null?t:[]}getValidLevels(t){return this.levels.filter((r,n)=>this.isLevelAllowed(r)&&n<=t)}getMaxLevel(t){let r=super.getMaxLevel(t),n=this.getValidLevels(t);if(!n[r])return r;let o=Math.min(n[r].width,n[r].height),a=Z.minMaxResolution;return o>=a?r:Ge.getMaxLevelByMediaSize(n,a*(16/9),a)}};Z.minMaxResolution=720;var me=Z,qe=me;var ee={FAIRPLAY:"fairplay",PLAYREADY:"playready",WIDEVINE:"widevine"},nt=e=>{if(e.includes("fps"))return ee.FAIRPLAY;if(e.includes("playready"))return ee.PLAYREADY;if(e.includes("widevine"))return ee.WIDEVINE},ot=e=>{let t=e.split(`
`).find((r,n,o)=>n&&o[n-1].startsWith("#EXT-X-STREAM-INF"));return fetch(t).then(r=>r.status!==200?Promise.reject(r):r.text())},at=e=>{let t=e.split(`
`).filter(n=>n.startsWith("#EXT-X-SESSION-DATA"));if(!t.length)return{};let r={};for(let n of t){let o=st(n),a=o["DATA-ID"];a&&(r[a]={...o})}return{sessionData:r}},zt=/([A-Z0-9-]+)="?(.*?)"?(?:,|$)/g;function st(e){let t=[...e.matchAll(zt)];return Object.fromEntries(t.map(([,r,n])=>[r,n]))}var it=e=>{var c,f,u;let t=e.split(`
`),n=(f=((c=t.find(s=>s.startsWith("#EXT-X-PLAYLIST-TYPE")))!=null?c:"").split(":")[1])==null?void 0:f.trim(),o=oe(n),a=ae(n),i;if(o===_.LIVE){let s=t.find(l=>l.startsWith("#EXT-X-PART-INF"));if(!!s)i=+s.split(":")[1].split("=")[1]*2;else{let l=t.find(x=>x.startsWith("#EXT-X-TARGETDURATION")),p=(u=l==null?void 0:l.split(":"))==null?void 0:u[1];i=+(p!=null?p:6)*3}}return{streamType:o,targetLiveWindow:a,liveEdgeStartOffset:i}},ct=async(e,t)=>{if(t===N.MP4)return{streamType:_.ON_DEMAND,targetLiveWindow:Number.NaN,liveEdgeStartOffset:void 0,sessionData:void 0};if(t===N.M3U8){let r=await fetch(e);if(!r.ok)return Promise.reject(r);let n=await r.text(),o=await ot(n);return{...at(n),...it(o)}}return console.error(`Media type ${t} is an unrecognized or unsupported type for src ${e}.`),{streamType:void 0,targetLiveWindow:void 0,liveEdgeStartOffset:void 0,sessionData:void 0}},ut=async(e,t,r=F({src:e}))=>{var f,u,s,d;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:a,sessionData:i}=await ct(e,r),c=i==null?void 0:i["com.apple.hls.chapters"];(c!=null&&c.URI||c!=null&&c.VALUE.toLocaleLowerCase().startsWith("http"))&&te((f=c.URI)!=null?f:c.VALUE,t),((u=P.get(t))!=null?u:{}).liveEdgeStartOffset=a,((s=P.get(t))!=null?s:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((d=P.get(t))!=null?d:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},te=async(e,t)=>{var r;try{let n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch Mux metadata: ${n.status} ${n.statusText}`);let o=await n.json(),a={};for(let c of o[0].metadata)c.key&&c.value&&(a[c.key]=c.value);((r=P.get(t))!=null?r:{}).metadata=a;let i=new CustomEvent("muxmetadata");t.dispatchEvent(i)}catch(n){console.error(n)}},dt=e=>{var i;let t=e.type,r=oe(t),n=ae(t),o,a=!!((i=e.partList)!=null&&i.length);return r===_.LIVE&&(o=a?e.partTarget*2:e.targetduration*3),{streamType:r,targetLiveWindow:n,liveEdgeStartOffset:o,lowLatency:a}},lt=(e,t,r)=>{var c,f,u,s,d,l,p,T;let{streamType:n,targetLiveWindow:o,liveEdgeStartOffset:a,lowLatency:i}=dt(e);if(n===_.LIVE){i?(r.config.backBufferLength=(c=r.userConfig.backBufferLength)!=null?c:4,r.config.maxFragLookUpTolerance=(f=r.userConfig.maxFragLookUpTolerance)!=null?f:.001,r.config.abrBandWidthUpFactor=(u=r.userConfig.abrBandWidthUpFactor)!=null?u:r.config.abrBandWidthFactor):r.config.backBufferLength=(s=r.userConfig.backBufferLength)!=null?s:8;let x=Object.freeze({get length(){return t.seekable.length},start(R){return t.seekable.start(R)},end(R){var h;return R>this.length||R<0||Number.isFinite(t.duration)?t.seekable.end(R):(h=r.liveSyncPosition)!=null?h:t.seekable.end(R)}});((d=P.get(t))!=null?d:{}).seekable=x}((l=P.get(t))!=null?l:{}).liveEdgeStartOffset=a,((p=P.get(t))!=null?p:{}).targetLiveWindow=o,t.dispatchEvent(new CustomEvent("targetlivewindowchange",{composed:!0,bubbles:!0})),((T=P.get(t))!=null?T:{}).streamType=n,t.dispatchEvent(new CustomEvent("streamtypechange",{composed:!0,bubbles:!0}))},Xe,ze,Qt=(ze=(Xe=globalThis==null?void 0:globalThis.navigator)==null?void 0:Xe.userAgent)!=null?ze:"",Qe,Ze,et,Zt=(et=(Ze=(Qe=globalThis==null?void 0:globalThis.navigator)==null?void 0:Qe.userAgentData)==null?void 0:Ze.platform)!=null?et:"",er=Qt.toLowerCase().includes("android")||["x11","android"].some(e=>Zt.toLowerCase().includes(e)),P=new WeakMap,S="mux.com",tt,rt,pt=(rt=(tt=g).isSupported)==null?void 0:rt.call(tt),tr=er,rr=()=>$.default.utils.now(),ft=$.default.utils.generateUUID,nr=({playbackId:e,customDomain:t=S,maxResolution:r,minResolution:n,renditionOrder:o,programStartTime:a,programEndTime:i,assetStartTime:c,assetEndTime:f,playbackToken:u,tokens:{playback:s=u}={},extraSourceParams:d={}}={})=>{if(!e)return;let[l,p=""]=K(e),T=new URL(`https://stream.${t}/${l}.m3u8${p}`);return s||T.searchParams.has("token")?(T.searchParams.forEach((x,R)=>{R!="token"&&T.searchParams.delete(R)}),s&&T.searchParams.set("token",s)):(r&&T.searchParams.set("max_resolution",r),n&&(T.searchParams.set("min_resolution",n),r&&+r.slice(0,-1)<+n.slice(0,-1)&&console.error("minResolution must be <= maxResolution","minResolution",n,"maxResolution",r)),o&&T.searchParams.set("rendition_order",o),a&&T.searchParams.set("program_start_time",`${a}`),i&&T.searchParams.set("program_end_time",`${i}`),c&&T.searchParams.set("asset_start_time",`${c}`),f&&T.searchParams.set("asset_end_time",`${f}`),Object.entries(d).forEach(([x,R])=>{R!=null&&T.searchParams.set(x,R)})),T.toString()},re=e=>{if(!e)return;let[t]=e.split("?");return t||void 0},Me=e=>{if(!e||!e.startsWith("https://stream."))return;let[t]=new URL(e).pathname.slice(1).split(/\.m3u8|\//);return t||void 0},or=e=>{var t,r,n;return(t=e==null?void 0:e.metadata)!=null&&t.video_id?e.metadata.video_id:Ce(e)&&(n=(r=re(e.playbackId))!=null?r:Me(e.src))!=null?n:e.src},Tt=e=>{var t;return(t=P.get(e))==null?void 0:t.error},ar=e=>{var t;return(t=P.get(e))==null?void 0:t.metadata},Ee=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.streamType)!=null?r:_.UNKNOWN},sr=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.targetLiveWindow)!=null?r:Number.NaN},Re=e=>{var t,r;return(r=(t=P.get(e))==null?void 0:t.seekable)!=null?r:e.seekable},ir=e=>{var n;let t=(n=P.get(e))==null?void 0:n.liveEdgeStartOffset;if(typeof t!="number")return Number.NaN;let r=Re(e);return r.length?r.end(r.length-1)-t:Number.NaN},xe=.034,cr=(e,t,r=xe)=>Math.abs(e-t)<=r,yt=(e,t,r=xe)=>e>t||cr(e,t,r),mt=(e,t=xe)=>e.paused&&yt(e.currentTime,e.duration,t),be=(e,t)=>{var u,s,d;if(!t||!e.buffered.length)return;if(e.readyState>2)return!1;let r=t.currentLevel>=0?(s=(u=t.levels)==null?void 0:u[t.currentLevel])==null?void 0:s.details:(d=t.levels.find(l=>!!l.details))==null?void 0:d.details;if(!r||r.live)return;let{fragments:n}=r;if(!(n!=null&&n.length))return;if(e.currentTime<e.duration-(r.targetduration+.5))return!1;let o=n[n.length-1];if(e.currentTime<=o.start)return!1;let a=o.start+o.duration/2,i=e.buffered.start(e.buffered.length-1),c=e.buffered.end(e.buffered.length-1);return a>i&&a<c},Et=(e,t)=>e.ended||e.loop?e.ended:t&&be(e,t)?!0:mt(e),ur=(e,t,r)=>{gt(t,r,e);let{metadata:n={}}=e,{view_session_id:o=ft()}=n,a=or(e);n.view_session_id=o,n.video_id=a,e.metadata=n;let i=s=>{var d;(d=t.mux)==null||d.emit("hb",{view_drm_type:s})};e.drmTypeCb=i,P.set(t,{retryCount:0});let c=Rt(e,t),f=Ue(e,t,c);e!=null&&e.muxDataKeepSession&&(t!=null&&t.mux)&&!t.mux.deleted?c&&t.mux.addHLSJS({hlsjs:c,Hls:c?g:void 0}):Pt(e,t,c),_t(e,t,c),le(t),ye(t);let u=Oe(e,t,c);return{engine:c,setAutoplay:u,setPreload:f}},gt=(e,t,r)=>{let n=t==null?void 0:t.engine;e!=null&&e.mux&&!e.mux.deleted&&(r!=null&&r.muxDataKeepSession?n&&e.mux.removeHLSJS():(e.mux.destroy(),delete e.mux)),n&&(n.detachMedia(),n.destroy()),e&&(e.hasAttribute("src")&&(e.removeAttribute("src"),e.load()),e.removeEventListener("error",ht),e.removeEventListener("error",ge),e.removeEventListener("durationchange",kt),P.delete(e),e.dispatchEvent(new Event("teardown")))};function Mt(e,t){var u;let r=F(e);if(!(r===N.M3U8))return!0;let o=!r||((u=t.canPlayType(r))!=null?u:!0),{preferPlayback:a}=e,i=a===j.MSE,c=a===j.NATIVE;return o&&(c||!(pt&&(i||tr)))}var Rt=(e,t)=>{let{debug:r,streamType:n,startTime:o=-1,metadata:a,preferCmcd:i,_hlsConfig:c={}}=e,u=F(e)===N.M3U8,s=Mt(e,t);if(u&&!s&&pt){let d={backBufferLength:30,renderTextTracksNatively:!1,liveDurationInfinity:!0,capLevelToPlayerSize:!0,capLevelOnFPSDrop:!0},l=xt(n),p=bt(e),T=[A.QUERY,A.HEADER].includes(i)?{useHeaders:i===A.HEADER,sessionId:a==null?void 0:a.view_session_id,contentId:a==null?void 0:a.video_id}:void 0,x=new g({debug:r,startPosition:o,cmcd:T,xhrSetup:(R,h)=>{var m,k;if(i&&i!==A.QUERY)return;let E=new URL(h);if(!E.searchParams.has("CMCD"))return;let D=((k=(m=E.searchParams.get("CMCD"))==null?void 0:m.split(","))!=null?k:[]).filter(ve=>ve.startsWith("sid")||ve.startsWith("cid")).join(",");E.searchParams.set("CMCD",D),R.open("GET",E)},capLevelController:qe,...d,...l,...p,...c});return x.on(g.Events.MANIFEST_PARSED,async function(R,h){var D,m;let E=(D=h.sessionData)==null?void 0:D["com.apple.hls.chapters"];(E!=null&&E.URI||E!=null&&E.VALUE.toLocaleLowerCase().startsWith("http"))&&te((m=E==null?void 0:E.URI)!=null?m:E==null?void 0:E.VALUE,t)}),x}},xt=e=>e===_.LIVE?{backBufferLength:8}:{},bt=e=>{let{tokens:{drm:t}={},playbackId:r,drmTypeCb:n}=e,o=re(r);return!t||!o?{}:{emeEnabled:!0,drmSystems:{"com.apple.fps":{licenseUrl:Y(e,"fairplay"),serverCertificateUrl:De(e,"fairplay")},"com.widevine.alpha":{licenseUrl:Y(e,"widevine")},"com.microsoft.playready":{licenseUrl:Y(e,"playready")}},requestMediaKeySystemAccessFunc:(a,i)=>(a==="com.widevine.alpha"&&(i=[...i.map(c=>{var u;let f=(u=c.videoCapabilities)==null?void 0:u.map(s=>({...s,robustness:"HW_SECURE_ALL"}));return{...c,videoCapabilities:f}}),...i]),navigator.requestMediaKeySystemAccess(a,i).then(c=>{let f=nt(a);return n==null||n(f),c}))}},Dt=async e=>{let t=await fetch(e);return t.status!==200?Promise.reject(t):await t.arrayBuffer()},Ct=async(e,t)=>{let r=await fetch(t,{method:"POST",headers:{"Content-type":"application/octet-stream"},body:e});if(r.status!==200)return Promise.reject(r);let n=await r.arrayBuffer();return new Uint8Array(n)},vt=(e,t)=>{v(t,"encrypted",async n=>{try{let o=n.initDataType;if(o!=="skd"){console.error(`Received unexpected initialization data type "${o}"`);return}if(!t.mediaKeys){let u=await navigator.requestMediaKeySystemAccess("com.apple.fps",[{initDataTypes:[o],videoCapabilities:[{contentType:"application/vnd.apple.mpegurl",robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}]).then(d=>{var l;return(l=e.drmTypeCb)==null||l.call(e,ee.FAIRPLAY),d}).catch(()=>{let d=M("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser."),l=new y(d,y.MEDIA_ERR_ENCRYPTED,!0);l.errorCategory=C.DRM,l.muxCode=b.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM,I(t,l)});if(!u)return;let s=await u.createMediaKeys();try{let d=await Dt(De(e,"fairplay")).catch(l=>{if(l instanceof Response){let p=W(l,C.DRM,e);return console.error("mediaError",p==null?void 0:p.message,p==null?void 0:p.context),p?Promise.reject(p):Promise.reject(new Error("Unexpected error in app cert request"))}return Promise.reject(l)});await s.setServerCertificate(d).catch(()=>{let l=M("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate."),p=new y(l,y.MEDIA_ERR_ENCRYPTED,!0);return p.errorCategory=C.DRM,p.muxCode=b.ENCRYPTED_UPDATE_SERVER_CERT_FAILED,Promise.reject(p)})}catch(d){I(t,d);return}await t.setMediaKeys(s)}let a=n.initData;if(a==null){console.error(`Could not start encrypted playback due to missing initData in ${n.type} event`);return}let i=t.mediaKeys.createSession();i.addEventListener("keystatuseschange",()=>{i.keyStatuses.forEach(u=>{let s;if(u==="internal-error"){let d=M("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");s=new y(d,y.MEDIA_ERR_ENCRYPTED,!0),s.errorCategory=C.DRM,s.muxCode=b.ENCRYPTED_CDM_ERROR}else if(u==="output-restricted"||u==="output-downscaled"){let d=M("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");s=new y(d,y.MEDIA_ERR_ENCRYPTED,!1),s.errorCategory=C.DRM,s.muxCode=b.ENCRYPTED_OUTPUT_RESTRICTED}s&&I(t,s)})});let c=await Promise.all([i.generateRequest(o,a).catch(()=>{let u=M("Failed to generate a DRM license request. This may be an issue with the player or your protected content."),s=new y(u,y.MEDIA_ERR_ENCRYPTED,!0);s.errorCategory=C.DRM,s.muxCode=b.ENCRYPTED_GENERATE_REQUEST_FAILED,I(t,s)}),new Promise(u=>{i.addEventListener("message",s=>{u(s.message)},{once:!0})})]).then(([,u])=>u),f=await Ct(c,Y(e,"fairplay")).catch(u=>{if(u instanceof Response){let s=W(u,C.DRM,e);return console.error("mediaError",s==null?void 0:s.message,s==null?void 0:s.context),s?Promise.reject(s):Promise.reject(new Error("Unexpected error in license key request"))}return Promise.reject(u)});await i.update(f).catch(()=>{let u=M("Failed to update DRM license. This may be an issue with the player or your protected content."),s=new y(u,y.MEDIA_ERR_ENCRYPTED,!0);return s.errorCategory=C.DRM,s.muxCode=b.ENCRYPTED_UPDATE_LICENSE_FAILED,Promise.reject(s)})}catch(o){I(t,o);return}})},Y=({playbackId:e,tokens:{drm:t}={},customDomain:r=S},n)=>{let o=re(e);return`https://license.${r.toLocaleLowerCase().endsWith(S)?r:S}/license/${n}/${o}?token=${t}`},De=({playbackId:e,tokens:{drm:t}={},customDomain:r=S},n)=>{let o=re(e);return`https://license.${r.toLocaleLowerCase().endsWith(S)?r:S}/appcert/${n}/${o}?token=${t}`},Ce=({playbackId:e,src:t,customDomain:r})=>{if(e)return!0;if(typeof t!="string")return!1;let n=window==null?void 0:window.location.href,o=new URL(t,n).hostname.toLocaleLowerCase();return o.includes(S)||!!r&&o.includes(r.toLocaleLowerCase())},Pt=(e,t,r)=>{var f;let{envKey:n,disableTracking:o,muxDataSDK:a=$.default,muxDataSDKOptions:i={}}=e,c=Ce(e);if(!o&&(n||c)){let{playerInitTime:u,playerSoftwareName:s,playerSoftwareVersion:d,beaconCollectionDomain:l,debug:p,disableCookies:T}=e,x={...e.metadata,video_title:((f=e==null?void 0:e.metadata)==null?void 0:f.video_title)||void 0},R=h=>typeof h.player_error_code=="string"?!1:typeof e.errorTranslator=="function"?e.errorTranslator(h):h;a.monitor(t,{debug:p,beaconCollectionDomain:l,hlsjs:r,Hls:r?g:void 0,automaticErrorTracking:!1,errorTranslator:R,disableCookies:T,...i,data:{...n?{env_key:n}:{},player_software_name:s,player_software:s,player_software_version:d,player_init_time:u,...x}})}},_t=(e,t,r)=>{var s,d;let n=Mt(e,t),{src:o,customDomain:a=S}=e,i=()=>{t.ended||!Et(t,r)||(be(t,r)?t.currentTime=t.buffered.end(t.buffered.length-1):t.dispatchEvent(new Event("ended")))},c,f,u=()=>{let l=Re(t),p,T;l.length>0&&(p=l.start(0),T=l.end(0)),(f!==T||c!==p)&&t.dispatchEvent(new CustomEvent("seekablechange",{composed:!0})),c=p,f=T};if(v(t,"durationchange",u),t&&n){let l=F(e);if(typeof o=="string"){if(o.endsWith(".mp4")&&o.includes(a)){let x=Me(o),R=new URL(`https://stream.${a}/${x}/metadata.json`);te(R.toString(),t)}let p=()=>{if(Ee(t)!==_.LIVE||Number.isFinite(t.duration))return;let x=setInterval(u,1e3);t.addEventListener("teardown",()=>{clearInterval(x)},{once:!0}),v(t,"durationchange",()=>{Number.isFinite(t.duration)&&clearInterval(x)})},T=async()=>ut(o,t,l).then(p).catch(x=>{if(x instanceof Response){let R=W(x,C.VIDEO,e);if(R){I(t,R);return}}else x instanceof Error});if(t.preload==="none"){let x=()=>{T(),t.removeEventListener("loadedmetadata",R)},R=()=>{T(),t.removeEventListener("play",x)};v(t,"play",x,{once:!0}),v(t,"loadedmetadata",R,{once:!0})}else T();(s=e.tokens)!=null&&s.drm?vt(e,t):v(t,"encrypted",()=>{let x=M("Attempting to play DRM-protected content without providing a DRM token."),R=new y(x,y.MEDIA_ERR_ENCRYPTED,!0);R.errorCategory=C.DRM,R.muxCode=b.ENCRYPTED_MISSING_TOKEN,I(t,R)},{once:!0}),t.setAttribute("src",o),e.startTime&&(((d=P.get(t))!=null?d:{}).startTime=e.startTime,t.addEventListener("durationchange",kt,{once:!0}))}else t.removeAttribute("src");t.addEventListener("error",ht),t.addEventListener("error",ge),t.addEventListener("emptied",()=>{t.querySelectorAll("track[data-removeondestroy]").forEach(T=>{T.remove()})},{once:!0}),v(t,"pause",i),v(t,"seeked",i),v(t,"play",()=>{t.ended||yt(t.currentTime,t.duration)&&(t.currentTime=t.seekable.length?t.seekable.start(0):0)})}else r&&o?(r.once(g.Events.LEVEL_LOADED,(l,p)=>{lt(p.details,t,r),u(),Ee(t)===_.LIVE&&!Number.isFinite(t.duration)&&(r.on(g.Events.LEVEL_UPDATED,u),v(t,"durationchange",()=>{Number.isFinite(t.duration)&&r.off(g.Events.LEVELS_UPDATED,u)}))}),r.on(g.Events.ERROR,(l,p)=>{var x,R;let T=dr(p,e);if(T.muxCode===b.NETWORK_NOT_READY){let E=(x=P.get(t))!=null?x:{},D=(R=E.retryCount)!=null?R:0;if(D<6){let m=D===0?5e3:6e4,k=new y(`Retrying in ${m/1e3} seconds...`,T.code,T.fatal);Object.assign(k,T),I(t,k),setTimeout(()=>{E.retryCount=D+1,p.details==="manifestLoadError"&&p.url&&r.loadSource(p.url)},m);return}else{E.retryCount=0;let m=new y('Try again later or <a href="#" onclick="window.location.reload(); return false;" style="color: #4a90e2;">click here to retry</a>',T.code,T.fatal);Object.assign(m,T),I(t,m);return}}I(t,T)}),r.on(g.Events.MANIFEST_LOADED,()=>{let l=P.get(t);l&&l.error&&(l.error=null,l.retryCount=0,t.dispatchEvent(new Event("emptied")),t.dispatchEvent(new Event("loadstart")))}),t.addEventListener("error",ge),v(t,"waiting",i),He(e,r),Ve(t,r),r.attachMedia(t)):console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")};function kt(e){var n;let t=e.target,r=(n=P.get(t))==null?void 0:n.startTime;if(r&&he(t.seekable,t.duration,r)){let o=t.preload==="auto";o&&(t.preload="none"),t.currentTime=r,o&&(t.preload="auto")}}async function ht(e){if(!e.isTrusted)return;e.stopImmediatePropagation();let t=e.target;if(!(t!=null&&t.error))return;let{message:r,code:n}=t.error,o=new y(r,n);if(t.src&&n===y.MEDIA_ERR_SRC_NOT_SUPPORTED&&t.readyState===HTMLMediaElement.HAVE_NOTHING){setTimeout(()=>{var i;let a=(i=Tt(t))!=null?i:t.error;(a==null?void 0:a.code)===y.MEDIA_ERR_SRC_NOT_SUPPORTED&&I(t,o)},500);return}if(t.src&&(n!==y.MEDIA_ERR_DECODE||n!==void 0))try{let{status:a}=await fetch(t.src);o.data={response:{code:a}}}catch{}I(t,o)}function I(e,t){var r;t.fatal&&(((r=P.get(e))!=null?r:{}).error=t,e.dispatchEvent(new CustomEvent("error",{detail:t})))}function ge(e){var n,o;if(!(e instanceof CustomEvent)||!(e.detail instanceof y))return;let t=e.target,r=e.detail;!r||!r.fatal||(((n=P.get(t))!=null?n:{}).error=r,(o=t.mux)==null||o.emit("error",{player_error_code:r.code,player_error_message:r.message,player_error_context:r.context}))}var dr=(e,t)=>{var c,f,u;console.error("getErrorFromHlsErrorData()",e);let r={[g.ErrorTypes.NETWORK_ERROR]:y.MEDIA_ERR_NETWORK,[g.ErrorTypes.MEDIA_ERROR]:y.MEDIA_ERR_DECODE,[g.ErrorTypes.KEY_SYSTEM_ERROR]:y.MEDIA_ERR_ENCRYPTED},n=s=>[g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED].includes(s.details)?y.MEDIA_ERR_NETWORK:r[s.type],o=s=>{if(s.type===g.ErrorTypes.KEY_SYSTEM_ERROR)return C.DRM;if(s.type===g.ErrorTypes.NETWORK_ERROR)return C.VIDEO},a,i=n(e);if(i===y.MEDIA_ERR_NETWORK&&e.response){let s=(c=o(e))!=null?c:C.VIDEO;a=(f=W(e.response,s,t,e.fatal))!=null?f:new y("",i,e.fatal)}else if(i===y.MEDIA_ERR_ENCRYPTED)if(e.details===g.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE){let s=M("Attempting to play DRM-protected content without providing a DRM token.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_MISSING_TOKEN}else if(e.details===g.ErrorDetails.KEY_SYSTEM_NO_ACCESS){let s=M("Cannot play DRM-protected content with current security configuration on this browser. Try playing in another browser.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_UNSUPPORTED_KEY_SYSTEM}else if(e.details===g.ErrorDetails.KEY_SYSTEM_NO_SESSION){let s=M("Failed to generate a DRM license request. This may be an issue with the player or your protected content.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,!0),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_GENERATE_REQUEST_FAILED}else if(e.details===g.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED){let s=M("Failed to update DRM license. This may be an issue with the player or your protected content.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_UPDATE_LICENSE_FAILED}else if(e.details===g.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED){let s=M("Your server certificate failed when attempting to set it. This may be an issue with a no longer valid certificate.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_UPDATE_SERVER_CERT_FAILED}else if(e.details===g.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR){let s=M("The DRM Content Decryption Module system had an internal failure. Try reloading the page, upading your browser, or playing in another browser.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_CDM_ERROR}else if(e.details===g.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED){let s=M("DRM playback is being attempted in an environment that is not sufficiently secure. User may see black screen.");a=new y(s,y.MEDIA_ERR_ENCRYPTED,!1),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_OUTPUT_RESTRICTED}else a=new y(e.error.message,y.MEDIA_ERR_ENCRYPTED,e.fatal),a.errorCategory=C.DRM,a.muxCode=b.ENCRYPTED_ERROR;else a=new y("",i,e.fatal);return a.context||(a.context=`${e.url?`url: ${e.url}
`:""}${e.response&&(e.response.code||e.response.text)?`response: ${e.response.code}, ${e.response.text}
`:""}${e.reason?`failure reason: ${e.reason}
`:""}${e.level?`level: ${e.level}
`:""}${e.parent?`parent stream controller: ${e.parent}
`:""}${e.buffer?`buffer length: ${e.buffer}
`:""}${e.error?`error: ${e.error}
`:""}${e.event?`event: ${e.event}
`:""}${e.err?`error message: ${(u=e.err)==null?void 0:u.message}
`:""}`),a.data=e,a};
//# sourceMappingURL=index.cjs.js.map
